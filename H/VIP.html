<!DOCTYPE html>
<html>
<head>
    <title>PDF资源库 - 安全访问</title>
    <!-- 复用微信提示框CSS -->
    <style>
        /* 此处直接复用原有.wechat-overlay、.tip-card等样式 */
        .wechat-input {
            width: 80%; 
            padding: 12px; 
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div id="auth-overlay"></div>
    <div id="pdf-list" style="display:none;"></div>

    <script>
        // 初始化时隐藏内容
        document.addEventListener('DOMContentLoaded', async () => {
            const token = new URLSearchParams(location.search).get('token');
            if (!token) showAuthDialog();
            else loadData(token);
        });

        async function loadData(token) {
            try {
                const { pdfList } = await fetch(`/api/pdf-list?token=${token}`).then(res => res.json());
                renderPDFList(pdfList); // 动态生成文档列表
            } catch (err) {
                showError('资源加载失败，请检查网络');
            }
        }

        function renderPDFList(list) {
            const container = document.getElementById('pdf-list');
            list.forEach(pdf => {
                const card = document.createElement('div');
                card.className = 'page-wrapper'; // 复用PDF卡片样式
                card.innerHTML = `
                    <h3>${pdf.name}</h3>
                    <a href="/viewer.html?token=${getToken()}&file=${encodeURI(pdf.path)}" 
                       class="copy-btn download-btn">查看文档</a>
                `;
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
